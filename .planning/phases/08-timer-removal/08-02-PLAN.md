---
phase: 08-timer-removal
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/app/layout.tsx
  - src/components/staff/index.ts
  - src/components/tasks/garment-task-summary.tsx
  - src/components/tasks/task-management-modal.tsx
  - src/components/board/order-card.tsx
  - src/app/board/page.tsx
  - src/app/api/order/[id]/stage/route.ts
  - src/app/api/tasks/[taskId]/route.ts
autonomous: true

must_haves:
  truths:
    - "No stopwatch/timer visible anywhere in app (TMR-01)"
    - "No Start/Stop/Pause buttons exist (TMR-02)"
    - "Actual time displays as read-only where previously timer showed"
    - "No console errors from removed timer code (Success Criteria #5)"
    - "App builds and runs successfully"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout without ActiveTaskIndicator"
      contains: "StaffIndicator"
      not_contains: "ActiveTaskIndicator"
    - path: "src/components/staff/index.ts"
      provides: "Staff exports without timer-related components"
      not_contains: "ActiveTaskIndicator|OneTaskWarningModal"
    - path: "src/components/tasks/garment-task-summary.tsx"
      provides: "Task summary with time display, no timer controls"
      not_contains: "TimerButton"
    - path: "src/components/board/order-card.tsx"
      provides: "Order card without timer button"
      not_contains: "TimerButton"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/staff/index.ts"
      via: "Import statement"
      pattern: "StaffSessionProvider.*StaffIndicator"
    - from: "src/components/tasks/garment-task-summary.tsx"
      to: "actual_minutes display"
      via: "Read-only time rendering"
      pattern: "actual_minutes|actualMinutes"
---

<objective>
Remove all timer imports and usage from remaining files, clean up timer-related logic in API routes.

Purpose: Complete the timer removal by updating all files that imported deleted components, ensuring the app builds without errors and no timer UI is visible (TMR-01, TMR-02).

Output: Clean codebase with no timer references, app builds successfully, time displays as read-only.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-timer-removal/08-RESEARCH.md
@.planning/phases/08-timer-removal/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update layout.tsx and staff/index.ts exports</name>
  <files>
    src/app/layout.tsx
    src/components/staff/index.ts
  </files>
  <action>
1. Update `src/app/layout.tsx`:
   - Remove `ActiveTaskIndicator` from the import statement on line 12
   - Remove the `<ActiveTaskIndicator />` component from the header nav (around line 117)
   - Keep `StaffSessionProvider`, `StaffPinModal`, `StaffIndicator` - they are unrelated to timer

   Before (lines 8-13):
   ```tsx
   import {
     StaffSessionProvider,
     StaffPinModal,
     StaffIndicator,
     ActiveTaskIndicator,  // REMOVE THIS
   } from '@/components/staff';
   ```

   After:
   ```tsx
   import {
     StaffSessionProvider,
     StaffPinModal,
     StaffIndicator,
   } from '@/components/staff';
   ```

   Before (around line 117):
   ```tsx
   <ActiveTaskIndicator />
   <StaffIndicator />
   ```

   After:
   ```tsx
   <StaffIndicator />
   ```

2. Update `src/components/staff/index.ts`:
   - Remove the export for `ActiveTaskIndicator`
   - Remove the export for `OneTaskWarningModal`

   Before:
   ```tsx
   export { StaffSessionProvider, useStaffSession } from './staff-session-provider';
   export { StaffPinModal } from './staff-pin-modal';
   export { StaffPinInput } from './staff-pin-input';
   export { StaffIndicator } from './staff-indicator';
   export { ActiveTaskIndicator } from './active-task-indicator';  // REMOVE
   export { OneTaskWarningModal } from './one-task-warning-modal';  // REMOVE
   ```

   After:
   ```tsx
   export { StaffSessionProvider, useStaffSession } from './staff-session-provider';
   export { StaffPinModal } from './staff-pin-modal';
   export { StaffPinInput } from './staff-pin-input';
   export { StaffIndicator } from './staff-indicator';
   ```
  </action>
  <verify>
```bash
# Check no timer references in layout
grep -n "ActiveTaskIndicator" src/app/layout.tsx

# Check exports are clean
cat src/components/staff/index.ts

# TypeScript should not complain about missing exports
npx tsc --noEmit src/app/layout.tsx 2>&1 | head -20
```
  </verify>
  <done>layout.tsx no longer imports or renders ActiveTaskIndicator. Staff index.ts exports only non-timer components.</done>
</task>

<task type="auto">
  <name>Task 2: Remove TimerButton from task components and order-card</name>
  <files>
    src/components/tasks/garment-task-summary.tsx
    src/components/tasks/task-management-modal.tsx
    src/components/board/order-card.tsx
  </files>
  <action>
1. Update `src/components/tasks/garment-task-summary.tsx`:
   - Remove TimerButton import (line 4): `import { TimerButton } from '@/components/timer/timer-button';`
   - Remove TimerState and TimerUpdateData interfaces (lines 28-42)
   - Remove timerState useState and related state management
   - Remove fetchTimerState function and useEffect
   - Remove TimerButton component usage (around lines 189-199)
   - KEEP the time display showing actual_minutes as read-only text
   - Keep estimated_minutes display (Planifie vs Reel comparison)
   - Replace timer controls with simple read-only time display:
     ```tsx
     <div className="text-sm text-muted-foreground">
       {task.actual_minutes > 0 ? `${Math.floor(task.actual_minutes / 60)}h ${task.actual_minutes % 60}m` : 'â€”'}
     </div>
     ```

2. Update `src/components/tasks/task-management-modal.tsx`:
   - Remove TimerButton import (line 11): `import { TimerButton } from '@/components/timer/timer-button';`
   - Remove TimerButton component usage (around line 364)
   - Keep the rest of the modal functionality intact

3. Update `src/components/board/order-card.tsx`:
   - Remove TimerButton import (line 11): `import { TimerButton } from '@/components/timer/timer-button';`
   - Remove TimerButton component and its surrounding div (around line 237)
   - The {/* Timer */} comment can also be removed
  </action>
  <verify>
```bash
# No TimerButton references should exist
grep -rn "TimerButton" src/components/tasks/
grep -rn "TimerButton" src/components/board/

# No timer-utils imports
grep -rn "timer-utils" src/components/

# Files should still have their core functionality
grep -n "GarmentTaskSummary" src/components/tasks/garment-task-summary.tsx
grep -n "TaskManagementModal" src/components/tasks/task-management-modal.tsx
grep -n "OrderCard" src/components/board/order-card.tsx
```
  </verify>
  <done>TimerButton removed from garment-task-summary.tsx, task-management-modal.tsx, and order-card.tsx. Time displays as read-only where appropriate.</done>
</task>

<task type="auto">
  <name>Task 3: Clean up timer references in API routes and board page</name>
  <files>
    src/app/board/page.tsx
    src/app/api/order/[id]/stage/route.ts
    src/app/api/tasks/[taskId]/route.ts
  </files>
  <action>
1. Update `src/app/board/page.tsx`:
   - Find the error handling around lines 214-215 that mentions timer
   - Remove or simplify the conditional that checks for 'work time' or 'timer' errors
   - The generic error handling can remain, just remove timer-specific messaging

   Before (around line 214-215):
   ```tsx
   if (errorMessage.includes('work time') || errorMessage.includes('timer')) {
     toast.error('Cannot mark as done: Please record work hours using the timer first.');
   ```

   After:
   ```tsx
   // Remove this timer-specific error handling entirely
   // Let the generic error message show instead
   ```

2. Update `src/app/api/order/[id]/stage/route.ts`:
   - Around line 133: Remove the error message about using timer
   - Around lines 172-173: Remove the comments about timer
   - The stage transition logic should still work, but without enforcing timer usage

   Changes needed:
   - Line 133: Change error message from timer-specific to generic or remove the check entirely
   - Lines 172-173: Remove outdated timer comments

3. Update `src/app/api/tasks/[taskId]/route.ts`:
   - Around lines 81-91: Remove the check for "timer is running" when updating actual_minutes
   - Around lines 154-163: Remove the check for "timer is running" when deleting task

   These checks reference `is_active` column which is timer state. Since we're removing timers,
   tasks can always be updated/deleted regardless of previous timer state.

   Remove these blocks:
   ```tsx
   // Prevent updating actual_minutes if timer is running
   ...
   if (existingTask?.is_active) {
     return NextResponse.json(
       { error: 'Cannot update time while timer is running. Please stop the timer first.' },
       { status: 400 }
     );
   }
   ```
  </action>
  <verify>
```bash
# No timer-specific error messages in board page
grep -n "timer" src/app/board/page.tsx

# No timer enforcement in stage route
grep -n "timer" src/app/api/order/[id]/stage/route.ts

# No timer checks in tasks route
grep -n "timer" src/app/api/tasks/[taskId]/route.ts
grep -n "is_active" src/app/api/tasks/[taskId]/route.ts

# Build test
npm run build 2>&1 | tail -20
```
  </verify>
  <done>Timer references removed from board/page.tsx, order stage route no longer enforces timer usage, tasks route no longer checks for running timer.</done>
</task>

</tasks>

<verification>
Full verification after all tasks complete:

```bash
# 1. No timer references anywhere in codebase
grep -rn "TimerButton" src/
grep -rn "ActiveTaskIndicator" src/
grep -rn "useActiveTask" src/
grep -rn "@/components/timer" src/
grep -rn "@/lib/timer" src/
grep -rn "OneTaskWarningModal" src/

# 2. Build succeeds
npm run build

# 3. TypeScript compilation succeeds
npx tsc --noEmit

# 4. No console errors (manual check during dev server)
npm run dev
# Visit http://localhost:3000/board
# Open browser console - should be no timer-related errors
```
</verification>

<success_criteria>
1. `npm run build` completes without errors
2. `npx tsc --noEmit` shows no TypeScript errors
3. No grep matches for TimerButton, ActiveTaskIndicator, useActiveTask in src/
4. App runs without console errors related to timer imports
5. Header no longer shows ActiveTaskIndicator
6. Order cards no longer show timer controls
7. Task summary shows actual time as read-only text (not interactive timer)
</success_criteria>

<output>
After completion, create `.planning/phases/08-timer-removal/08-02-SUMMARY.md`
</output>
