---
phase: 05-list-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/hooks/useViewPreference.ts
  - src/components/intake/garment-services-step.tsx
autonomous: false

must_haves:
  truths:
    - "User can toggle between Grid and List view in service selection"
    - "List view shows services in compact table format (Service | Price | Time | Select)"
    - "View preference persists across browser sessions"
    - "Long service names are truncated with tooltip on hover"
  artifacts:
    - path: "src/lib/hooks/useViewPreference.ts"
      provides: "View preference persistence hook"
      exports: ["useViewPreference", "ViewMode"]
    - path: "src/components/intake/garment-services-step.tsx"
      provides: "Service selection with grid/list toggle"
      contains: "viewMode === 'list'"
  key_links:
    - from: "src/components/intake/garment-services-step.tsx"
      to: "src/lib/hooks/useViewPreference.ts"
      via: "import and hook usage"
      pattern: "useViewPreference"
    - from: "garment-services-step.tsx"
      to: "localStorage"
      via: "useViewPreference hook"
      pattern: "hc_services_view_mode"
---

<objective>
Add Grid/List view toggle to service selection in intake flow with persistent preference.

Purpose: Allow users to switch between grid view (current cards) and list view (compact table) when selecting services. View preference should persist across sessions so users don't need to re-select each time.

Output: Modified GarmentServicesStep with toggle button and two view modes, backed by a reusable view preference hook.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-list-view/05-RESEARCH.md

# Reference patterns from codebase
@src/app/board/page.tsx (lines 297-315 for view toggle UI pattern)
@src/components/board/order-list-view.tsx (for table styling pattern)
@src/lib/hooks/useCurrentStaff.ts (for localStorage pattern)
@src/components/intake/garment-services-step.tsx (target file)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useViewPreference hook</name>
  <files>src/lib/hooks/useViewPreference.ts</files>
  <action>
Create a custom React hook for persisting view preference to localStorage.

Follow the pattern from useCurrentStaff.ts for SSR safety:
- Use 'use client' directive
- Load from localStorage in useEffect (not useState initializer) to avoid hydration mismatch
- Check `typeof window !== 'undefined'` before localStorage access
- Handle errors gracefully with try/catch
- Default to 'grid' view until client-side hydration completes

Storage key: 'hc_services_view_mode'

Export:
- `ViewMode` type: 'grid' | 'list'
- `useViewPreference(defaultMode?: ViewMode)` function returning:
  - `viewMode: ViewMode`
  - `setViewMode: (mode: ViewMode) => void`
  - `isLoaded: boolean`

The hook should:
1. Initialize with defaultMode (default 'grid')
2. Load persisted value from localStorage on mount
3. Persist changes to localStorage when setViewMode is called
4. Return isLoaded=false until hydration is complete
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit src/lib/hooks/useViewPreference.ts
```
  </verify>
  <done>
Hook file exists at src/lib/hooks/useViewPreference.ts with ViewMode type and useViewPreference function exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add view toggle and list view to GarmentServicesStep</name>
  <files>src/components/intake/garment-services-step.tsx</files>
  <action>
Modify GarmentServicesStep to add Grid/List toggle in the service selection section (Section 2).

1. Add imports at top:
   - `LayoutGrid, List` from 'lucide-react'
   - `useViewPreference` from '@/lib/hooks/useViewPreference'

2. Add hook usage in component (after existing state declarations, around line 117):
   ```typescript
   const { viewMode, setViewMode, isLoaded } = useViewPreference('grid');
   ```

3. Add view toggle UI in Section 2, between the section title "2. Services" and the category tabs (around line 671).
   Copy the exact toggle pattern from board/page.tsx lines 297-315:
   - Container: `flex bg-muted p-1 rounded-lg border border-border`
   - Buttons with variant toggling between 'secondary' and 'ghost'
   - LayoutGrid icon for "Grid", List icon for "List"
   - Use `hidden sm:inline` for labels to be icon-only on mobile

4. Replace the service grid (lines 705-725) with conditional rendering:
   ```typescript
   {viewMode === 'grid' ? (
     // Existing grid code
   ) : (
     // New list view table
   )}
   ```

5. Create list view table following order-list-view.tsx pattern:
   - Container: `bg-card rounded-lg shadow overflow-hidden`
   - Table with columns: Service | Price | Time | Select
   - Header row with `bg-muted/50` and uppercase text-xs styling
   - Body rows with `hover:bg-muted/50` and `divide-y divide-border`
   - Service name: Use `truncate max-w-[200px]` with `title={service.name}` for tooltip
   - Price: Use formatCurrency(service.base_price_cents)
   - Time: Show `service.estimated_minutes` if available, otherwise display "-"
   - Select: Button with "Add" text, onClick={addServiceToCurrentGarment(service)}

6. Keep the "Aucun service trouve" empty state for both views.

Do NOT modify:
- Section 1 (garment type selection)
- Section 3 (selected services with assignment)
- Section 4 (order items)
- Any existing functionality
  </action>
  <verify>
1. Run TypeScript check:
```bash
npx tsc --noEmit
```

2. Start dev server and test:
```bash
npm run dev
```
Then navigate to /intake, go to step 2 (garment services), verify:
- Toggle button appears between "2. Services" title and category tabs
- Clicking "List" shows table view with 4 columns
- Clicking "Grid" shows original card view
- Clicking "Add" in list view adds service
  </verify>
  <done>
- Toggle button visible in service selection section
- Grid view shows original card layout
- List view shows compact table with Service | Price | Time | Select columns
- Time column shows estimated_minutes or "-" when unavailable
- Both views support adding services
- Long service names truncated with native tooltip on hover
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify persistence and UI-09 compliance</name>
  <what-built>Grid/List view toggle with localStorage persistence and 4-column table (Service | Price | Time | Select)</what-built>
  <how-to-verify>
1. **View persistence check:**
   - Go to /intake, reach service selection step
   - Switch to List view
   - Refresh the page (or close and reopen browser)
   - Navigate back to service selection
   - Confirm List view is still selected
   - Check browser console: `localStorage.getItem('hc_services_view_mode')` should return 'list'

2. **List view columns check:**
   - Verify table shows 4 columns: Service | Price | Time | Select
   - Verify Time column displays estimated minutes or "-" for services without time data

3. **UI-09 compliance (product names):**
   - Confirm services show actual product names (e.g., "Hem Pants", "Shorten Sleeves")
   - Confirm NO "Number 1", "Number 2" labels exist

4. **Long name handling:**
   - Find a service with a long name
   - Verify it truncates in list view
   - Hover to confirm full name appears in tooltip
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Overall phase verification:

1. Toggle button visible and functional:
   ```bash
   # Visual check: toggle exists between section title and tabs
   grep -n "viewMode === 'list'" src/components/intake/garment-services-step.tsx
   ```

2. List view shows compact table format:
   - Columns: Service | Price | Time | Select
   - Table styling matches order-list-view.tsx pattern

3. View preference persists:
   ```javascript
   // Browser console
   localStorage.getItem('hc_services_view_mode') // Returns 'grid' or 'list'
   ```

4. Long names truncated with tooltip:
   - Add service with long name
   - In list view, confirm truncation + hover shows full name
</verification>

<success_criteria>
1. Toggle button visible and functional in service selection
2. List view shows services in table format (Service | Price | Time | Select)
3. View preference persists across sessions (localStorage)
4. No more "Number 1" labels (already verified in research - confirm)
5. Long product names truncated elegantly with tooltip
</success_criteria>

<output>
After completion, create `.planning/phases/05-list-view/05-01-SUMMARY.md`
</output>
