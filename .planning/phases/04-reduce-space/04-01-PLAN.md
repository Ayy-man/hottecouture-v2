---
phase: 04-reduce-space
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/collapsible-section.tsx
  - src/components/ui/collapsible-notes.tsx
autonomous: true

must_haves:
  truths:
    - "CollapsibleSection can expand/collapse with single click"
    - "CollapsibleNotes shows indicator when notes exist but collapsed"
    - "Both components follow codebase UI patterns"
  artifacts:
    - path: "src/components/ui/collapsible-section.tsx"
      provides: "Reusable collapsible section wrapper"
      exports: ["CollapsibleSection"]
    - path: "src/components/ui/collapsible-notes.tsx"
      provides: "Notes-specific collapsible with edit support"
      exports: ["CollapsibleNotes"]
  key_links:
    - from: "src/components/ui/collapsible-section.tsx"
      to: "tailwind"
      via: "transition-transform rotate-180"
      pattern: "transition-transform.*rotate-180"
---

<objective>
Create reusable CollapsibleSection and CollapsibleNotes components for Phase 4 space reduction.

Purpose: These components enable the "collapsed by default" Notes fields (UI-05) and provide a consistent pattern for collapsible content throughout the app. The Notes component specifically saves ~120px per field when collapsed.

Output: Two new UI components in `/src/components/ui/` following existing codebase patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-reduce-space/04-RESEARCH.md

Key patterns from research:
- Existing collapsible pattern in client-step.tsx (lines 871-889)
- Chevron rotation: `transition-transform rotate-180`
- Border style: `border border-border rounded-md overflow-hidden`
- Button style: `bg-muted/50 hover:bg-muted transition-colors`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CollapsibleSection component</name>
  <files>src/components/ui/collapsible-section.tsx</files>
  <action>
Create a reusable CollapsibleSection component following the pattern from client-step.tsx.

Props interface:
- `label: string` - Section header text
- `defaultExpanded?: boolean` - Initial state (default: false)
- `children: React.ReactNode` - Content to show when expanded
- `className?: string` - Additional classes for content area
- `hasContent?: boolean` - Show indicator dot when true and collapsed

Implementation:
1. Use 'use client' directive (needs useState)
2. Use existing pattern from client-step.tsx for structure
3. SVG chevron with `transition-transform` and `rotate-180` when expanded
4. Content area with `p-3 space-y-3` padding
5. Border container with `border border-border rounded-md overflow-hidden`
6. Button area at least 44px height for touch targets (use `py-2`)
7. Add small dot indicator (w-1.5 h-1.5 bg-primary-500 rounded-full) when hasContent=true and collapsed

Use cn() from @/lib/utils for className merging.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit src/components/ui/collapsible-section.tsx
```
  </verify>
  <done>
CollapsibleSection component exists with expand/collapse functionality, chevron animation, and content indicator.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CollapsibleNotes component</name>
  <files>src/components/ui/collapsible-notes.tsx</files>
  <action>
Create a CollapsibleNotes component specialized for notes display with edit support.

Props interface:
- `notes: string | null | undefined` - The notes text
- `onEdit?: () => void` - Called when Edit button clicked
- `label?: string` - Header text (default: "Notes")
- `defaultExpanded?: boolean` - Initial state (default: false)
- `maxHeight?: string` - Max height for expanded content (default: "80px")

Implementation:
1. Use 'use client' directive
2. Wrap CollapsibleSection with hasContent={!!notes}
3. When collapsed: show just the header with indicator
4. When expanded: show notes in scrollable div with max-height
5. Edit button in header (onClick stops propagation, calls onEdit)
6. Empty state: show "No notes" in italic when no notes
7. Content area: `text-xs text-muted-foreground bg-muted/20 overflow-y-auto`

Height savings: ~160px textarea -> ~40px collapsed header
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit src/components/ui/collapsible-notes.tsx
```
  </verify>
  <done>
CollapsibleNotes component exists with edit callback, content indicator, and scrollable expanded view.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify components with dev server</name>
  <files>None (verification only)</files>
  <action>
1. Start dev server if not running: `npm run dev`
2. Verify no TypeScript errors in terminal output
3. Check that both components export correctly by importing them in a test

Create a quick test by temporarily adding to any page:
```tsx
import { CollapsibleSection } from '@/components/ui/collapsible-section';
import { CollapsibleNotes } from '@/components/ui/collapsible-notes';
```

If imports resolve without error, components are correctly exported.
  </action>
  <verify>
```bash
npm run build 2>&1 | head -50
```
Build should not show TypeScript errors for the new components.
  </verify>
  <done>
Both components compile, export correctly, and are ready for use in Plan 04-02.
  </done>
</task>

</tasks>

<verification>
1. Both component files exist in src/components/ui/
2. TypeScript compilation passes
3. Components follow codebase patterns (cn utility, Tailwind classes)
4. CollapsibleSection has chevron animation
5. CollapsibleNotes has edit callback and content indicator
</verification>

<success_criteria>
- CollapsibleSection toggles on click with animated chevron
- CollapsibleNotes displays indicator dot when notes exist but collapsed
- Both components use consistent styling with existing codebase
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-reduce-space/04-01-SUMMARY.md`
</output>
