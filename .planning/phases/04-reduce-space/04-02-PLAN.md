---
phase: 04-reduce-space
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/board/order-detail-modal.tsx
autonomous: true

must_haves:
  truths:
    - "Order details modal vertical height reduced by at least 40%"
    - "All information remains accessible (nothing permanently hidden)"
    - "Text remains readable (not cramped)"
    - "Notes expandable with single click"
  artifacts:
    - path: "src/components/board/order-detail-modal.tsx"
      provides: "Compact order detail modal with collapsible notes"
      min_lines: 1000
  key_links:
    - from: "src/components/board/order-detail-modal.tsx"
      to: "src/components/ui/collapsible-notes.tsx"
      via: "import CollapsibleNotes"
      pattern: "import.*CollapsibleNotes"
---

<objective>
Apply space reduction changes to order-detail-modal.tsx to achieve 40% vertical height reduction.

Purpose: This is the primary target for Phase 4. The order detail modal currently uses generous spacing (24px sections, 16px fields) and always-visible Notes textareas (~160px each). By reducing spacing and making Notes collapsible, we eliminate the "endless scrolling" complaint.

Output: Modified order-detail-modal.tsx with compact spacing and collapsible notes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-reduce-space/04-RESEARCH.md
@.planning/phases/04-reduce-space/04-01-SUMMARY.md

Key file: src/components/board/order-detail-modal.tsx (~1259 lines)

Current spacing (from research):
- Modal container: p-4 sm:p-6 -> p-3 sm:p-4
- Section headers: mb-6 -> mb-3
- Grid gaps: gap-4 sm:gap-6 -> gap-2 sm:gap-4
- Inner spacing: space-y-4 -> space-y-2
- Garment cards: p-4 -> p-3
- Section dividers: mt-3 pt-3 -> mt-2 pt-2
- Notes: rows={4} textarea -> CollapsibleNotes (collapsed default)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply spacing reductions to modal structure</name>
  <files>src/components/board/order-detail-modal.tsx</files>
  <action>
Apply systematic spacing reductions following research recommendations.

Changes to make (search and replace patterns):

1. **Container padding (line ~448):**
   - `p-4 sm:p-6` -> `p-3 sm:p-4`

2. **Header section (line ~450):**
   - `mb-6` -> `mb-4`
   - Title: `text-xl sm:text-2xl` -> `text-lg sm:text-xl`

3. **Main grid (line ~485):**
   - `gap-4 sm:gap-6 mb-6` -> `gap-3 sm:gap-4 mb-4`

4. **Order Info section (line ~487):**
   - `space-y-4` -> `space-y-2`
   - Header: `text-lg font-semibold` -> `text-base font-semibold mb-2`

5. **Client Info section (line ~615):**
   - `space-y-4` -> `space-y-2`
   - Header: `text-lg font-semibold` -> `text-base font-semibold mb-2`
   - Notes divider: `mt-3 pt-3` -> `mt-2 pt-2`

6. **Measurements section (line ~682):**
   - `mb-6` -> `mb-4`
   - Header: `text-lg font-semibold mb-4` -> `text-base font-semibold mb-2`
   - Container: `p-4` -> `p-3`

7. **Garments section (line ~711):**
   - `mb-6` -> `mb-4`
   - Header: `text-lg font-semibold mb-4` -> `text-base font-semibold mb-2`
   - Cards: `space-y-4` -> `space-y-3`

8. **Individual garment cards (line ~719):**
   - Card: `p-4` -> `p-3`
   - Inner margins: `mb-3` -> `mb-2`

9. **Services section (line ~935):**
   - Divider: `mt-3 pt-3` -> `mt-2 pt-2`
   - Service cards: `p-3` -> `p-2`
   - `space-y-2` -> `space-y-1`

10. **Pricing section (line ~1076):**
    - `mb-6` -> `mb-4`
    - Header: `text-lg font-semibold mb-4` -> `text-base font-semibold mb-2`
    - Container: `p-4` -> `p-3`

11. **Payment section (line ~1198):**
    - `mb-6` -> `mb-4`

12. **Actions section (line ~1218):**
    - `gap-3` -> `gap-2`

DO NOT change:
- Font sizes below text-xs (keep readability)
- Button sizes (maintain 44px touch targets)
- Critical spacing inside input fields
  </action>
  <verify>
File saves without syntax errors. Check with:
```bash
npx tsc --noEmit src/components/board/order-detail-modal.tsx 2>&1 | head -20
```
  </verify>
  <done>
All spacing reductions applied. Modal structure is more compact.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert Notes textareas to CollapsibleNotes</name>
  <files>src/components/board/order-detail-modal.tsx</files>
  <action>
Replace Notes textarea sections with CollapsibleNotes component.

1. **Add import at top of file:**
```tsx
import { CollapsibleNotes } from '@/components/ui/collapsible-notes';
```

2. **Replace garment notes section (lines ~779-836):**

Current pattern (in each garment card):
```tsx
{/* Notes Section - Always Visible */}
<div className='mb-3'>
  <label className='block text-sm font-medium text-muted-foreground mb-2'>
    Notes:
  </label>
  {editingGarmentId === garment.id ? (
    // ... editing mode with Textarea
  ) : (
    <div className='space-y-2'>
      <Textarea ... readOnly ... />
      <Button ... onClick={() => handleStartEditNotes(...)} ...>
        Edit Notes
      </Button>
    </div>
  )}
</div>
```

Replace with:
```tsx
{/* Notes Section - Collapsible */}
<div className='mb-2'>
  {editingGarmentId === garment.id ? (
    <div className='space-y-2'>
      <label className='block text-xs font-medium text-muted-foreground mb-1'>
        Notes:
      </label>
      <Textarea
        value={editingNotes}
        onChange={e => setEditingNotes(e.target.value)}
        rows={3}
        className='w-full min-h-[60px] text-sm'
        placeholder='Special instructions, damage notes, etc.'
        disabled={savingNotes === garment.id}
      />
      <div className='flex gap-2'>
        <Button
          size='sm'
          onClick={() => handleSaveNotes(garment.id)}
          disabled={savingNotes === garment.id}
          className='bg-primary hover:bg-primary-600'
        >
          {savingNotes === garment.id ? 'Saving...' : 'Save'}
        </Button>
        <Button
          size='sm'
          variant='outline'
          onClick={handleCancelEditNotes}
          disabled={savingNotes === garment.id}
        >
          Cancel
        </Button>
      </div>
    </div>
  ) : (
    <CollapsibleNotes
      notes={garment.notes}
      onEdit={() => handleStartEditNotes(garment.id, garment.notes)}
      label='Notes'
      defaultExpanded={false}
    />
  )}
</div>
```

3. **Reduce editing textarea size:**
   - `rows={4}` -> `rows={3}`
   - `min-h-[100px]` -> `min-h-[60px]`

4. **Service notes (line ~962-971):**
Keep service notes as-is (they're already small inline text), but ensure they stay compact.

Space savings per garment: ~120px (160px textarea -> 40px collapsed header)
  </action>
  <verify>
```bash
npx tsc --noEmit src/components/board/order-detail-modal.tsx 2>&1 | head -20
```
No TypeScript errors about CollapsibleNotes import or usage.
  </verify>
  <done>
Notes textareas replaced with CollapsibleNotes. Collapsed by default, saving ~120px per garment.
  </done>
</task>

<task type="auto">
  <name>Task 3: Apply 2-column layout to Order/Client info</name>
  <files>src/components/board/order-detail-modal.tsx</files>
  <action>
Convert Order Information and Client Information from single-column to 2-column layouts.

1. **Order Information section (lines ~491-611):**

Current (single column, ~120px):
```tsx
<div className='space-y-2'>
  <div className='flex justify-between'>
    <span className='text-muted-foreground'>Type:</span>
    <span className='font-medium capitalize'>{order.type}</span>
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground'>Status:</span>
    ...
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground'>Priority:</span>
    ...
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground'>Due Date:</span>
    ...
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground'>Created:</span>
    ...
  </div>
</div>
```

Convert to 2-column grid (~60px):
```tsx
<div className='grid grid-cols-2 gap-x-4 gap-y-1 text-sm'>
  <div className='flex justify-between'>
    <span className='text-muted-foreground text-xs'>Type:</span>
    <span className='font-medium capitalize text-xs'>{order.type}</span>
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground text-xs'>Status:</span>
    <span className='font-medium capitalize text-xs'>{order.status}</span>
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground text-xs'>Priority:</span>
    <span className='font-medium capitalize text-xs'>{order.priority || 'Normal'}</span>
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground text-xs'>Due:</span>
    <span className='font-medium text-xs'>{formatDate(order.due_date)}</span>
  </div>
  <div className='flex justify-between col-span-2'>
    <span className='text-muted-foreground text-xs'>Created:</span>
    <span className='font-medium text-xs'>{formatDate(order.created_at)}</span>
  </div>
</div>
```

Note: Keep rack position section separate (after the grid) since it has interactive elements.

2. **Client Information section (lines ~619-676):**

Convert client info fields to 2-column:
```tsx
<div className='grid grid-cols-2 gap-x-4 gap-y-1 text-sm'>
  <div className='flex justify-between col-span-2'>
    <span className='text-muted-foreground text-xs'>Name:</span>
    <span className='font-medium text-xs'>{order.client_name || 'Unknown Client'}</span>
  </div>
  <div className='flex justify-between items-center'>
    <span className='text-muted-foreground text-xs'>Phone:</span>
    <span className='font-medium font-mono text-xs'>
      {order.client_phone ? (revealedContact ? order.client_phone : maskPhone(order.client_phone)) : 'N/A'}
    </span>
  </div>
  <div className='flex justify-between items-center'>
    <span className='text-muted-foreground text-xs'>Email:</span>
    <span className='font-medium font-mono text-xs truncate max-w-[120px]'>
      {order.client_email ? (revealedContact ? order.client_email : maskEmail(order.client_email)) : 'N/A'}
    </span>
  </div>
  <div className='flex justify-between'>
    <span className='text-muted-foreground text-xs'>Language:</span>
    <span className='font-medium text-xs'>{order.client_language || 'English'}</span>
  </div>
</div>
```

Keep reveal button and history link below the grid.
Keep client notes section separate (it needs more space).

3. **Verify touch targets:**
Ensure all interactive elements remain at least 44px touch target.
  </action>
  <verify>
```bash
npx tsc --noEmit src/components/board/order-detail-modal.tsx 2>&1 | head -20
```
No TypeScript errors. Grid layouts render correctly.
  </verify>
  <done>
Order Info and Client Info use 2-column grids, reducing height by ~50% for these sections.
  </done>
</task>

</tasks>

<verification>
1. Modal compiles without TypeScript errors
2. CollapsibleNotes imported and used for garment notes
3. Spacing reduced throughout (mb-6->mb-3, space-y-4->space-y-2, etc.)
4. 2-column layouts applied to Order Info and Client Info
5. Text remains readable (nothing below text-xs for body)
6. Touch targets maintained (buttons at least 44px)
</verification>

<success_criteria>
- Order detail modal height reduced by at least 40% (measured visually)
- All information still accessible (collapsible sections expand on click)
- Text readable at arm's length on iPad
- Notes collapsed by default with indicator when content exists
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-reduce-space/04-02-SUMMARY.md`
</output>
