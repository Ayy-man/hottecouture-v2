---
phase: 07-exports
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/app/board/page.tsx
  - src/components/board/assignee-filter.tsx
autonomous: true

must_haves:
  truths:
    - "Export button appears when seamstress is selected in filter"
    - "3-dot menu contains Export Orders and Export Capacity options"
    - "Clicking export triggers download immediately"
    - "Filename includes seamstress name and date"
  artifacts:
    - path: "src/app/board/page.tsx"
      provides: "Export menu items in 3-dot dropdown"
      contains: "Export Orders"
    - path: "src/components/board/assignee-filter.tsx"
      provides: "Export button for selected seamstress"
      contains: "onExport"
  key_links:
    - from: "src/components/board/assignee-filter.tsx"
      to: "/api/admin/export/seamstress"
      via: "fetch call with seamstressId parameter"
      pattern: "fetch.*export/seamstress"
    - from: "src/app/board/page.tsx"
      to: "/api/admin/export/orders"
      via: "fetch call in dropdown handler"
      pattern: "fetch.*export/orders"
---

<objective>
Wire export APIs to board UI with export buttons in assignee filter and 3-dot menu.

Purpose: Make exports accessible from seamstress view (EXP-01) and 3-dot menu (EXP-03, EXP-04).
Output: Export functionality integrated into existing board page UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-exports/07-RESEARCH.md
@.planning/phases/07-exports/07-01-SUMMARY.md
@src/app/board/page.tsx
@src/components/board/assignee-filter.tsx
@src/lib/exports/csv-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add seamstress export to AssigneeFilter</name>
  <files>src/components/board/assignee-filter.tsx</files>
  <action>
Modify `/src/components/board/assignee-filter.tsx` to add export functionality:

1. Add new prop: `onExportSeamstress?: (seamstressId: string, seamstressName: string) => void`

2. When a seamstress is selected (not "all" or "unassigned"), show an export button/icon next to the dropdown or as a dropdown menu item.

3. Option A (preferred): Add a small Download icon button that appears when a seamstress is selected:
   ```tsx
   {selectedAssigneeId && selectedAssigneeId !== 'unassigned' && (
     <Button variant="ghost" size="sm" onClick={handleExport}>
       <Download className="w-4 h-4" />
     </Button>
   )}
   ```

4. The handleExport function should call `onExportSeamstress(selectedAssigneeId, selectedSeamstressName)`.

5. Import Download from lucide-react.

6. Find the selected seamstress name from the staff list (already available in component via orders prop or needs to be passed).

Alternative: If AssigneeFilter uses a Select/DropdownMenu, add "Export Tasks" as a menu item that only appears when viewing a specific seamstress's tasks.
  </action>
  <verify>
Component renders without errors. When a seamstress is selected, an export button/option is visible.
  </verify>
  <done>
AssigneeFilter shows export option when a seamstress is selected.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add export handlers to board page</name>
  <files>src/app/board/page.tsx</files>
  <action>
Modify `/src/app/board/page.tsx` to handle exports:

1. Import `triggerDownload` from `@/lib/exports/csv-utils`

2. Create `handleExportSeamstress` function:
   ```tsx
   const handleExportSeamstress = async (seamstressId: string, seamstressName: string) => {
     try {
       const response = await fetch(`/api/admin/export/seamstress?seamstressId=${seamstressId}`);
       const data = await response.json();
       if (data.success) {
         triggerDownload(data.csvContent, data.filename);
         toast.success(`Exported tasks for ${seamstressName}`);
       } else {
         throw new Error(data.error || 'Export failed');
       }
     } catch (error) {
       toast.error('Export failed');
       console.error('Export error:', error);
     }
   };
   ```

3. Create `handleExportOrders` function (similar pattern, no params needed)

4. Create `handleExportCapacity` function (similar pattern, no params needed)

5. Pass `onExportSeamstress={handleExportSeamstress}` to AssigneeFilter component

6. Add to existing 3-dot DropdownMenu (after "Archived Orders"):
   ```tsx
   <DropdownMenuSeparator />
   <DropdownMenuItem onClick={handleExportOrders}>
     <FileSpreadsheet className="w-4 h-4 mr-2" />
     <span>Export Orders</span>
   </DropdownMenuItem>
   <DropdownMenuItem onClick={handleExportCapacity}>
     <FileSpreadsheet className="w-4 h-4 mr-2" />
     <span>Export Capacity</span>
   </DropdownMenuItem>
   ```

7. Import FileSpreadsheet from lucide-react (or use Download icon)

8. Import DropdownMenuSeparator from dropdown-menu component
  </action>
  <verify>
- Board page loads without errors
- 3-dot menu shows "Export Orders" and "Export Capacity" options
- Clicking "Export Orders" downloads a CSV file
- Clicking "Export Capacity" downloads a CSV file
- Selecting a seamstress and clicking export downloads their tasks CSV
  </verify>
  <done>
All export buttons wired to APIs and trigger immediate CSV downloads.
  </done>
</task>

</tasks>

<verification>
1. Board page renders without errors: visit `/board`
2. 3-dot menu contains export options with separator
3. Export Orders downloads `orders_YYYY-MM-DD.csv`
4. Export Capacity downloads `capacity_*.csv`
5. Selecting a seamstress shows export option
6. Seamstress export downloads `projects_{name}_{date}.csv`
7. Toast notifications show on success/failure
</verification>

<success_criteria>
1. Export button accessible from seamstress view (EXP-01 success criteria #1)
2. CSV downloads immediately with correct data (EXP-01 success criteria #2)
3. Filename includes seamstress name and date (EXP-01 success criteria #3)
4. Orders and capacity exports available from 3-dot menu (EXP-01 success criteria #4)
</success_criteria>

<output>
After completion, create `.planning/phases/07-exports/07-02-SUMMARY.md`
</output>
