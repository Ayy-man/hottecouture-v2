---
phase: 07-exports
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/admin/team/route.ts
  - src/app/admin/team/page.tsx
autonomous: true

must_haves:
  truths:
    - "Team management page lists all staff members"
    - "Can add new team member via form"
    - "Can deactivate existing team members"
    - "Marie is added as main seamstress"
  artifacts:
    - path: "src/app/api/admin/team/route.ts"
      provides: "Staff CRUD API"
      exports: ["GET", "POST", "PATCH"]
    - path: "src/app/admin/team/page.tsx"
      provides: "Team management UI"
      contains: "Team Management"
  key_links:
    - from: "src/app/admin/team/page.tsx"
      to: "/api/admin/team"
      via: "fetch for CRUD operations"
      pattern: "fetch.*api/admin/team"
    - from: "src/app/api/admin/team/route.ts"
      to: "staff"
      via: "Supabase queries"
      pattern: "from.*staff"
---

<objective>
Create team member management form and add Marie as main seamstress.

Purpose: Fulfill EXP-05 (team management form) and EXP-06 (add Marie).
Output: Admin page for managing staff + Marie added to database.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-exports/07-RESEARCH.md
@src/lib/hooks/useStaff.ts
@src/app/admin/pricing/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create team management API</name>
  <files>src/app/api/admin/team/route.ts</files>
  <action>
Create `/src/app/api/admin/team/route.ts` with three handlers:

**GET handler:**
- Query all staff (not just active): `supabase.from('staff').select('*').order('name')`
- Return: `{ success: true, staff: [...] }`

**POST handler:**
- Parse body: `{ name: string }`
- Validate name is non-empty and at least 2 characters
- Check for duplicate name (case-insensitive)
- Insert into staff table: `{ name, is_active: true }`
- Return: `{ success: true, staff: newStaffMember }`

**PATCH handler:**
- Parse body: `{ id: string, is_active?: boolean, name?: string }`
- Update staff record by id
- Return: `{ success: true, staff: updatedStaffMember }`

Use createServiceRoleClient from @/lib/supabase/server. Return 400 for validation errors, 500 for server errors.
  </action>
  <verify>
- `curl http://localhost:3000/api/admin/team` returns list of staff
- `curl -X POST http://localhost:3000/api/admin/team -H "Content-Type: application/json" -d '{"name":"Test"}'` creates staff member
- POST with duplicate name returns 400 error
  </verify>
  <done>
Team API supports GET (list), POST (create), PATCH (update) operations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create team management page</name>
  <files>src/app/admin/team/page.tsx</files>
  <action>
Create `/src/app/admin/team/page.tsx` following the admin/pricing/page.tsx pattern:

1. Page structure:
   - Title: "Team Management"
   - Description: "Manage seamstresses and team members"
   - Two-column layout on desktop

2. Left card - Add New Team Member:
   - Input field for name
   - "Add Team Member" button
   - Loading state while adding
   - Success/error feedback

3. Right card - Current Team Members:
   - List all staff members (both active and inactive)
   - Show name with active/inactive badge
   - Toggle button to activate/deactivate
   - Use green badge for active, gray for inactive

4. State management:
   - `staff` array (all team members)
   - `newName` string (form input)
   - `isAdding` boolean (loading state)
   - `fetchStaff()` function to reload list

5. Handlers:
   - `handleAddStaff()` - POST to /api/admin/team, refresh list on success
   - `handleToggleActive(id, currentState)` - PATCH to toggle is_active

6. Use components: Card, CardHeader, CardTitle, CardDescription, CardContent, Button, Input, Badge from existing UI library.

7. Import icons: UserPlus, Users from lucide-react.
  </action>
  <verify>
- Visit `/admin/team` - page renders without errors
- Can see list of existing team members
- Can add new team member using form
- Can toggle active/inactive status
  </verify>
  <done>
Team management page allows viewing, adding, and deactivating team members.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Marie as main seamstress (EXP-06)</name>
  <files>N/A (database operation)</files>
  <action>
Add Marie to the staff table via API call or direct Supabase insert.

**Option A - Via API (preferred for verification):**
```bash
curl -X POST http://localhost:3000/api/admin/team \
  -H "Content-Type: application/json" \
  -d '{"name":"Marie"}'
```

**Option B - Via Supabase SQL:**
```sql
INSERT INTO staff (name, is_active)
VALUES ('Marie', true)
ON CONFLICT (name) DO NOTHING;
```

If Marie already exists, verify she is active. If not active, activate her.

**Verification query:**
```sql
SELECT id, name, is_active FROM staff WHERE LOWER(name) = 'marie';
```

Note: The client specifically requested Marie as the "main seamstress". Ensure she exists and is active in the staff table.
  </action>
  <verify>
Query staff table: Marie exists with is_active = true.
Visit /admin/team: Marie appears in the team list with active badge.
  </verify>
  <done>
Marie exists in staff table as an active team member.
  </done>
</task>

</tasks>

<verification>
1. API routes work: GET returns staff list, POST creates, PATCH updates
2. Team management page accessible at /admin/team
3. Can add new team member via form
4. Can toggle active/inactive status
5. Marie exists in staff table and is active
6. No TypeScript errors: `npm run build` passes
</verification>

<success_criteria>
1. Can add new team members via form (EXP-05 success criteria #5)
2. Marie added as main seamstress (EXP-06)
3. Team members visible in list with active/inactive status
4. Can deactivate team members (soft delete pattern)
</success_criteria>

<output>
After completion, create `.planning/phases/07-exports/07-03-SUMMARY.md`
</output>
