---
phase: 26-staff-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/staff/route.ts
  - src/app/api/staff/[id]/route.ts
  - public/manifest.json
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can add, edit, archive, and delete staff members from the team management modal without 404 errors"
    - "App is installable as PWA on iOS (Add to Home Screen) and Android (Install App prompt)"
    - "Chatbot widget is completely removed from the DOM (not just hidden)"
  artifacts:
    - path: "src/app/api/staff/route.ts"
      provides: "GET and POST staff endpoints matching team-management-modal expectations"
      exports: ["GET", "POST"]
    - path: "src/app/api/staff/[id]/route.ts"
      provides: "PATCH and DELETE staff endpoints for individual member operations"
      exports: ["PATCH", "DELETE"]
    - path: "public/manifest.json"
      provides: "PWA manifest with app name, icons, display mode, theme colors"
      contains: "standalone"
    - path: "src/app/layout.tsx"
      provides: "PWA manifest reference, appleWebApp metadata, no chatbot wrapper"
      contains: "manifest"
  key_links:
    - from: "src/components/team/team-management-modal.tsx"
      to: "/api/staff"
      via: "fetch calls at lines 122, 155, 182, 206"
      pattern: "fetch.*api/staff"
    - from: "src/app/api/staff/route.ts"
      to: "src/app/api/admin/team/route.ts"
      via: "re-export of GET and POST handlers"
      pattern: "export.*GET.*POST"
    - from: "src/app/layout.tsx"
      to: "public/manifest.json"
      via: "metadata.manifest reference"
      pattern: "manifest.*manifest.json"
---

<objective>
Connect the existing staff management UI to backend API routes, configure PWA installability, and remove the hidden chatbot.

Purpose: Staff management modal calls `/api/staff/*` but backend lives at `/api/admin/team/*` causing 404s. PWA makes the app installable on devices. Chatbot was hidden in Phase 22 and should be permanently removed.

Output: Working staff CRUD at `/api/staff`, PWA manifest + metadata, clean layout without chatbot.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-staff-infrastructure/26-RESEARCH.md

Key files:
@src/app/api/admin/team/route.ts — Existing GET/POST/PATCH handlers
@src/app/api/admin/team/[id]/route.ts — Existing PATCH/DELETE handlers
@src/components/team/team-management-modal.tsx — UI that calls /api/staff/*
@src/app/layout.tsx — Metadata object + chatbot wrapper
@public/logo-round.jpg — Candidate source for PWA icons
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create staff API route aliases and remove chatbot</name>
  <files>
    src/app/api/staff/route.ts
    src/app/api/staff/[id]/route.ts
    src/app/layout.tsx
  </files>
  <action>
1. Create `src/app/api/staff/route.ts`:
   - NOTE: This directory already has sub-directories (active-task, set-pin, verify-pin) but NO route.ts file. Adding route.ts is safe and will not conflict.
   - Import GET and POST from `@/app/api/admin/team/route`:
     ```typescript
     export { GET, POST } from '@/app/api/admin/team/route';
     ```
   - This re-exports the existing handlers so `/api/staff` works identically to `/api/admin/team`.

2. Create `src/app/api/staff/[id]/route.ts`:
   - Import PATCH and DELETE from `@/app/api/admin/team/[id]/route`:
     ```typescript
     export { PATCH, DELETE } from '@/app/api/admin/team/[id]/route';
     ```
   - This re-exports the existing handlers so `/api/staff/:id` works identically to `/api/admin/team/:id`.

3. Remove chatbot from `src/app/layout.tsx`:
   - Delete the import line: `import { GlobalChatWrapper } from '@/components/chat/global-chat-wrapper';`
   - Delete the hidden div wrapper (lines 131-133):
     ```
     <div className='hidden print:hidden'>
       <GlobalChatWrapper />
     </div>
     ```
   - Per accumulated decision from Phase 22: chatbot was hidden (not removed). Phase 26 scope says "confirm chatbot removal". Since the chatbot has been hidden since Phase 22 and client said "removed" on Feb 11 call, we proceed with removal. The component files (global-chat-wrapper.tsx, internal-chat.tsx) remain in the codebase for potential future re-enablement — we only remove the usage from layout.
  </action>
  <verify>
    - Run `npx tsc --noEmit` — should compile clean (no import errors from removed chatbot, no issues with re-exports)
    - Verify `src/app/api/staff/route.ts` exists and contains re-exports
    - Verify `src/app/api/staff/[id]/route.ts` exists and contains re-exports
    - Verify layout.tsx has no GlobalChatWrapper import or JSX
  </verify>
  <done>
    - `/api/staff` endpoints respond identically to `/api/admin/team` (GET lists staff, POST creates staff)
    - `/api/staff/:id` endpoints respond identically to `/api/admin/team/:id` (PATCH updates, DELETE removes)
    - Team management modal CRUD operations work without 404 errors
    - No chatbot widget or hidden div in the rendered DOM
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure PWA manifest and metadata</name>
  <files>
    public/manifest.json
    src/app/layout.tsx
  </files>
  <action>
1. Create `public/manifest.json` with the following content:
   ```json
   {
     "name": "Hotte Couture",
     "short_name": "Hotte",
     "description": "Professional tailoring and custom design services",
     "start_url": "/",
     "scope": "/",
     "display": "standalone",
     "orientation": "portrait",
     "background_color": "#ffffff",
     "theme_color": "#6366f1",
     "categories": ["business", "productivity"],
     "icons": [
       {
         "src": "/logo-round.jpg",
         "sizes": "192x192",
         "type": "image/jpeg",
         "purpose": "any"
       },
       {
         "src": "/logo-round.jpg",
         "sizes": "512x512",
         "type": "image/jpeg",
         "purpose": "any"
       }
     ]
   }
   ```
   NOTE: We use the existing `logo-round.jpg` file for icons. While PNG is preferred, JPEG is valid per the Web App Manifest spec. The logo-round.jpg already exists in public/ and avoids the need for image conversion tooling. If the client wants proper sized PNG icons later, they can be generated from favicon.io or similar and swapped in.

2. Update `src/app/layout.tsx` metadata object:
   - Add `manifest: "/manifest.json"` to the metadata export
   - Add `appleWebApp` configuration:
     ```typescript
     appleWebApp: {
       capable: true,
       statusBarStyle: "default",
       title: "Hotte Couture",
     },
     ```
   - Update the `icons` section to include apple touch icon:
     ```typescript
     icons: {
       icon: '/favicon.ico',
       shortcut: '/favicon.ico',
       apple: '/logo-round.jpg',
     },
     ```
   - NOTE: The existing `apple: '/logo.jpg'` should be changed to `apple: '/logo-round.jpg'` since round icons display better as iOS home screen icons.

3. Add viewport `themeColor` to the existing viewport export:
   - The viewport export already exists (lines 22-27). Add `themeColor: '#6366f1'` to match the manifest theme_color.
   - Actually, themeColor belongs in metadata, not viewport. Add it to metadata instead:
     ```typescript
     themeColor: '#6366f1',
     ```
  </action>
  <verify>
    - Run `npx tsc --noEmit` — should compile clean
    - Verify `public/manifest.json` exists and is valid JSON (run `node -e "JSON.parse(require('fs').readFileSync('public/manifest.json','utf8'))"`)
    - Verify layout.tsx metadata includes `manifest: "/manifest.json"` and `appleWebApp` block
  </verify>
  <done>
    - PWA manifest at `/manifest.json` serves valid app metadata
    - Layout metadata references manifest and apple web app configuration
    - Apple touch icon points to logo-round.jpg
    - Theme color set to #6366f1 (indigo, matching existing brand)
    - App eligible for "Add to Home Screen" on iOS Safari and "Install" on Android Chrome
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles clean: `npx tsc --noEmit`
2. Staff API route aliasing: both `/api/staff` and `/api/staff/:id` route files exist with correct re-exports
3. PWA manifest: `public/manifest.json` is valid JSON with required fields (name, icons, display, start_url)
4. Layout metadata: manifest reference, appleWebApp, updated apple icon, theme color all present
5. Chatbot removed: no GlobalChatWrapper import or JSX in layout.tsx
6. No regressions: existing `/api/staff/active-task`, `/api/staff/set-pin`, `/api/staff/verify-pin` sub-routes unaffected
</verification>

<success_criteria>
- Team management modal can create, list, update, and delete staff members via /api/staff endpoints
- PWA manifest served at /manifest.json with valid app metadata
- App installable on devices (iOS Add to Home Screen, Android Install prompt)
- No chatbot widget in the DOM
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/26-staff-infrastructure/26-01-SUMMARY.md`
</output>
