---
phase: 21-verify-responsive-devices
plan: 03
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/components/board/interactive-board.tsx
  - src/components/ui/gantt.tsx
autonomous: true

must_haves:
  truths:
    - "Kanban board drag-and-drop works on iPad and iPhone touch devices"
    - "Gantt chart bar dragging works on touch devices"
    - "Gantt chart items are accessible on touch devices (no right-click dependency)"
  artifacts:
    - path: "src/components/board/interactive-board.tsx"
      provides: "DnD with both PointerSensor and TouchSensor"
      contains: "TouchSensor"
    - path: "src/components/ui/gantt.tsx"
      provides: "Touch event handlers for Gantt bar dragging"
      contains: "onTouchStart"
  key_links:
    - from: "src/components/board/interactive-board.tsx"
      to: "@dnd-kit/core"
      via: "useSensor with TouchSensor"
      pattern: "TouchSensor.*delay.*250"
    - from: "src/components/ui/gantt.tsx"
      to: "touch events"
      via: "onTouchStart/onTouchMove/onTouchEnd handlers"
      pattern: "onTouchStart|onTouchMove|onTouchEnd"
---

<objective>
Add touch device support to the kanban board drag-and-drop (C3) and Gantt chart bar dragging (C5), plus make Gantt context menu accessible on touch (H4).

Purpose: The kanban board uses only PointerSensor without TouchSensor, causing scroll-vs-drag conflicts on touch devices. The Gantt chart uses only mouse events, making bar dragging impossible on iPad/iPhone. The Gantt context menu requires right-click, which is not available on touch devices. These are critical interactive features that must work on the client's iPad.

Output: TouchSensor added to kanban DnD, touch events added to Gantt bar dragging, and long-press context menu for Gantt items on touch devices.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-verify-responsive-devices/21-RESEARCH.md

@src/components/board/interactive-board.tsx
@src/components/ui/gantt.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TouchSensor to InteractiveBoard kanban DnD (C3)</name>
  <files>src/components/board/interactive-board.tsx</files>
  <action>
    1. Find the existing sensor configuration. It currently uses only `PointerSensor`:
       ```tsx
       const sensors = useSensors(
         useSensor(PointerSensor, { activationConstraint: { distance: 5 } })
       );
       ```

    2. Import `TouchSensor` from `@dnd-kit/core` (add to existing import).

    3. Add a TouchSensor alongside the existing PointerSensor:
       ```tsx
       const sensors = useSensors(
         useSensor(PointerSensor, { activationConstraint: { distance: 5 } }),
         useSensor(TouchSensor, { activationConstraint: { delay: 250, tolerance: 5 } })
       );
       ```

    Key details:
    - `delay: 250` means the user must press and hold for 250ms before drag activates. This prevents accidental drags when scrolling.
    - `tolerance: 5` means the touch can move 5px during the delay without canceling the drag intent.
    - Keep the existing PointerSensor config unchanged.
    - Do NOT change any other DnD logic (onDragStart, onDragEnd, DndContext, etc.).

    WHY: `PointerSensor` technically handles touch events but does not distinguish between scroll gestures and drag gestures. `TouchSensor` with `delay` solves this by requiring a long-press before drag activates.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no TypeScript errors. Grep for `TouchSensor` in the file to confirm it's imported and used.</verify>
  <done>InteractiveBoard uses both PointerSensor and TouchSensor. Touch drag requires 250ms press-and-hold. TypeScript compiles clean.</done>
</task>

<task type="auto">
  <name>Task 2: Add touch support to Gantt chart dragging and context menu (C5, H4)</name>
  <files>src/components/ui/gantt.tsx</files>
  <action>
    **Fix C5 - Touch drag for Gantt bars:**

    Find the Gantt bar/feature item component that handles `mousedown`/`mousemove`/`mouseup` for drag-to-resize or drag-to-move (around lines 460-523).

    Add corresponding touch event handlers:

    ```tsx
    // In the drag handler setup (e.g., handleMouseDown or similar):
    const handleTouchStart = (e: React.TouchEvent) => {
      e.preventDefault(); // Prevent scroll while dragging
      const touch = e.touches[0];
      // Call the same drag-start logic as mousedown, using touch.clientX, touch.clientY
    };

    const handleTouchMove = (e: React.TouchEvent) => {
      e.preventDefault();
      const touch = e.touches[0];
      // Call the same drag-move logic as mousemove, using touch.clientX, touch.clientY
    };

    const handleTouchEnd = (e: React.TouchEvent) => {
      // Call the same drag-end logic as mouseup
    };
    ```

    On the draggable Gantt bar element, add:
    ```tsx
    onTouchStart={handleTouchStart}
    onTouchMove={handleTouchMove}
    onTouchEnd={handleTouchEnd}
    ```

    Key details:
    - Reuse the existing mouse event logic -- extract the coordinate-based logic into shared functions if needed
    - `e.preventDefault()` on touchstart and touchmove prevents the page from scrolling during drag
    - Use `e.touches[0].clientX` and `e.touches[0].clientY` as equivalents of `e.clientX` and `e.clientY`
    - If the drag uses `window.addEventListener('mousemove'/'mouseup')`, add equivalent `window.addEventListener('touchmove'/'touchend')` listeners and clean them up on unmount

    **Fix H4 - Long-press context menu for touch:**

    Find where the ContextMenu (right-click) is used on Gantt items (around lines 527-565).

    Add a long-press handler as an alternative trigger:

    ```tsx
    const [longPressTimer, setLongPressTimer] = useState<NodeJS.Timeout | null>(null);

    const handleLongPressStart = (e: React.TouchEvent, featureId: string) => {
      const timer = setTimeout(() => {
        // Open context menu / show action options at touch position
        // Use the same action handler as the right-click context menu
      }, 500); // 500ms long press
      setLongPressTimer(timer);
    };

    const handleLongPressEnd = () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        setLongPressTimer(null);
      }
    };
    ```

    On the Gantt item element:
    ```tsx
    onTouchStart={(e) => handleLongPressStart(e, feature.id)}
    onTouchEnd={handleLongPressEnd}
    onTouchCancel={handleLongPressEnd}
    ```

    Key details:
    - Long press (500ms) should trigger the same actions as right-click context menu
    - If the existing context menu uses Radix UI ContextMenu, consider replacing with a simpler dropdown that opens on long-press for touch
    - Clear the timer on touchend/touchcancel to prevent false triggers
    - This should NOT interfere with the drag handling -- if the touch moves beyond tolerance during the long-press timer, cancel the timer

    WHY: Right-click is not available on touch devices. Long-press is the standard mobile equivalent for context menus.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no TypeScript errors. Grep for `onTouchStart` in gantt.tsx to confirm touch handlers are added.</verify>
  <done>Gantt chart bars support touch dragging. Long-press opens context menu on touch devices. TypeScript compiles clean.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `grep "TouchSensor" src/components/board/interactive-board.tsx` returns matches
3. `grep "onTouchStart" src/components/ui/gantt.tsx` returns matches
4. `grep "onTouchMove" src/components/ui/gantt.tsx` returns matches
</verification>

<success_criteria>
- InteractiveBoard kanban uses both PointerSensor and TouchSensor from @dnd-kit/core
- Gantt chart bar dragging works with touch events (onTouchStart/onTouchMove/onTouchEnd)
- Gantt context menu accessible via long-press on touch devices
- All existing mouse-based interactions preserved
- TypeScript compiles clean
</success_criteria>

<output>
After completion, create `.planning/phases/21-verify-responsive-devices/21-03-SUMMARY.md`
</output>
